---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
subtitle: "Analiza nogometnih vratarjev"
author: "Maks Perbil"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
#runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

ANALIZA NOGOMETNIH VRATARJEV

Analiziral bom vse vratarje, ki so v sezoni 2018/2019 zbrali vsaj 5 nastopov v kateri od petih najmočnejših evropskih lig(to so španska, angleška, italjanska, nemška ter francoska). Vratarje bom analiziral in primerjal glede na tekme brez prejetega zadetka, obrambe(izven 16m, znotraj 16m, enajstmetrovke) absolutno in relativno(glede na število strelov), njihovo vključevanje v igro(izhod iz golove črte(uspešen, neuspešen), posredovanje pri predložkih) ter igro z nogo oz. točnost podaj(dolge, kratke podaje, asistence). Primerjal bom tudi lige glede na uspešnost vratarjev in poiskal povezave med uspešnostjo vratarjev ter končno uspešnostjo ekip za katere branijo.


***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.R", encoding="UTF-8")
```

Uvozili smo podatke o občinah v obliki HTML s spletne starni https://www.sofascore.com/sl/ Podatke imamo v petih razpredelnicah.

1. Tabela: tekme brez prejetega zadetka - 'tabela_1'
  - 'vratar' - (neurejen faktor)  
  - 'ekipa' - (neurejen faktor)
  - 'tekme brez prejetega zadetka' - (število)
  - 'odigrane tekme' - (število)
  
 2. Tabela: obrambe - 'tabela_2'
  - 'vratarji' - (neurejen faktor)
  - 'ekipa' - (neurejen faktor)
  - 'obrambe strelov izven 16m' - (število)
  - 'odstotek obramb strelov izven 16m' - (število)
  - 'obrambe strelov znotraj 16m' - (število)
  - 'odstotek obramb strelov znotraj 16m' - (število)
  - 'obrambe enajstmetrovk' - (število)
  - 'odstotek obramb enajstmetrovk' - (število)
  
3. Tabela: vključevanje v igro - 'tabela_3'
  - 'vratarji' - (neurejen faktor)
  - 'ekipa' - (neurejen faktor)
  - 'izhodi iz golove črte' - (število)
  - 'uspešni izhodi iz golove črte' - (število)
  - 'uspešno posredovanje pri predložkih' - (število)
  - 'napake pri predložkih' - (število)

4. Tabela: igra z nogo - tabela_4'
  - 'vratarji' - (neurejen faktor)
  - 'ekipa' - (neurejen faktor)
  - 'kratke podaje' - (število)
  - 'uspešnost kratkih podaj v odstotkih' - (število)
  - 'dolge podaje' - (število)
  - 'uspešnost dolgih podaj v odstotkih' - (število)
  - 'asistence za zadetek' - (število)








<!-- 1. `druzine` - podatki o družinah za vsako občino -->
<!--   - `obcina` - spremenljivka: ime občine (neurejen faktor), -->
<!--   - `velikost.druzine` - spremenljivka: število otrok v družini (število: 1, 2, 3 ali 4, kjer zadnja vrednost pomeni 4 ali več), -->
<!--   - `stevilo.druzin` - meritev: število družin z ustreznim številom otrok v ustrezni občini (število). -->

<!-- 2. `obcine` - podatki o občinah -->
<!--   - `obcina` - spremenljivka: ime občine (neurejen faktor), -->
<!--   - `povrsina` - meritev: površina občine v km$^2$ (število), -->
<!--   - `prebivalci` - meritev: prebivalstvo občine (število), -->
<!--   - `gostota` - meritev: število prebivalcev na km$^2$ (število), -->
<!--   - `naselja` - meritev: število naselij v občini (število), -->
<!--   - `ustanovitev` - meritev: leto ustanovitve občine (število), -->
<!--   - `pokrajina` - meritev: pokrajina, ki ji občina pripada (neurejen faktor), -->
<!--   - `regija` - meritev: regija, ki ji občina pripada (neurejen faktor), -->
<!--   - `odcepitev` - meritev: podatki o občinah, od katerih se je občina odcepila (besedilo). -->

<!-- **Opomba**: da bi razpredelnica `obcine` res bila v obliki *tidy data*, bi morali odstraniti stolpec `gostota` (saj je izpeljan iz stolpcev `povrsina` in `prebivalci`), podatke o pokrajinah pa bi morali premakniti v drugo razpredelnico, saj nekatere občine pripadajo dvema pokrajinama. Podobno bi morali narediti tudi s stolpcem `odcepitev`. -->

<!-- Spodnji graf prikazuje porazdelitev števila naselij v občinah. -->

<!-- ```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'} -->
<!-- ggplot(obcine, aes(x=naselja)) + geom_histogram() + -->
<!--   ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin") -->
<!-- ``` -->

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija_moja.r", encoding="UTF-8")
```

```{r graf1, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Tekme brez prejetega zadetka'}
ggplot(t1) + aes(x=appearances, y=cleanSheet, color=drzava) + geom_point()+ geom_text(aes(label=igralec),hjust=0, vjust=0) + ggtitle("Tekme brez prejetega zadetka") + xlab("Število nastopov") + ylab("Tekme brez prejetega zadetka")
```

```{r graf2, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Posredovanje pri enajstmetrovkah'}
ggplot(t2) + aes(x=penaltyFaced, y=penaltySave, color=drzava) + geom_point() + geom_text(aes(label=igralec),hjust=0, vjust=0) + ggtitle("Posredovanje pri enajstmetrovkah") + xlab("Število enajstmetrovk") + ylab("Število obranjenih enajstmetrovk")
```

```{r graf3, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Prejeti zadetki znotraj kazenskega prostora'}
ggplot(t2) + aes(x=savedShotsFromInsideTheBox, y=goalsConcededInsideTheBox, color=drzava) + geom_point() + geom_text(aes(label=igralec),hjust=0, vjust=0) + ggtitle("Posredovanje pri strelih znotraj kazenskega prostora") + xlab("Obranjeni streli znotraj kazenskega prostora") + ylab("Prejeti zadetki znotraj kazenskega prostora")
```

```{r graf4, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Posredovanje pri strelih izven kazenskega prostora'}
ggplot(t2) + aes(x=savedShotsFromOutsideTheBox, y=goalsConcededOutsideTheBox, color=drzava) + geom_point() + geom_text(aes(label=igralec),hjust=0, vjust=0) + ggtitle("Posredovanje pri strelih izven kazenskega prostora") + xlab("Obranjeni streli izven kazenskega prostora") + ylab("Prejeti zadetki izven kazenskega prostora")
```

```{r graf5, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Število uspešnih iztekov'}
ggplot(t3) + aes(x=runsOut, y=successfulRunsOut, color=drzava) + geom_point() + geom_text(aes(label=ifelse(successfulRunsOut>18,as.character(igralec),'')),hjust=0, vjust=0) + ggtitle("Iztekanja") + xlab("Število iztekov") + ylab("Število uspešnih iztekov")
```

```{r graf6, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Posredovanje pri predložkih'}
ggplot(t3) + aes(x=highClaims, y=crossesNotClaimed, color=drzava) + geom_point() + geom_text(aes(label=igralec),hjust=0, vjust=0) + ggtitle("Posredovanje pri predložkih") + xlab("Število ujetih predložkov") + ylab("Število napak pri predložkih")
```

```{r graf7, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Podaje'}
ggplot(t4) + aes(x=ekipa, y=totalPasses, size=accuratePassesPercentage, color=drzava) + geom_point() + geom_text(aes(label=igralec),hjust=0, vjust=0) + ggtitle("Podaje") + xlab("Ekipa") + ylab("Število podaj")

```

```{r graf8, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Dolge Žoge'}
ggplot(t4) + aes(x=accurateLongBallsPercentage, y=accurateLongBalls, size=accurateLongBallsPercentage, color=drzava) + geom_point() + geom_text(aes(label=igralec),hjust=0, vjust=0) + ggtitle("Dolge Žoge") + xlab("Odstotek natančnosti pri dolgih žogah") + ylab("Število dolgih žog")
```




```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Tekme brez prejetega zadetka, glede na države'}
tm_shape(merge(zemljevid,
               t1 %>% group_by(drzava) %>% summarise(cleanSheet=sum(cleanSheet)),
               by.x="SOVEREIGNT", by.y="drzava")) +
  tm_polygons("cleanSheet") + ggtitle("Tekme brez prejetega zadetka, glede na države")
```







<!-- Spodnji zemljevid prikazuje povprečno velikost družine za vsako občino. -->

<!-- ```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'} -->
<!-- ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")), -->
<!--                         aes(x=long, y=lat, group=group, fill=povprecje)) + -->
<!--   ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") + -->
<!--   guides(fill=guide_colorbar(title="Povprečje")) -->
<!-- ``` -->

***

# Napredna analiza podatkov

# ```{r analiza, echo=FALSE, message=FALSE}
# source("analiza/analiza.r", encoding="UTF-8")
# ```

<!-- Spodnji graf prikazuje povezavo med številom naselij in površino občine. -->

<!-- ```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'} -->
<!-- ggplot(inner_join(obcine, data.frame(obcina=names(skupine), -->
<!--                                      skupina=factor(skupine)), by="obcina") -->
<!-- , aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() + -->
<!--   ggtitle("Število naselij glede na površino občine") + -->
<!--   xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") + -->
<!--   guides(color=guide_legend(title="Skupina"), -->
<!--          size=guide_legend(title="Prebivalci (* 1000)")) -->
<!-- ``` -->

<!-- *** -->

<!-- ```{r shiny, echo=FALSE} -->
<!-- shinyAppDir("shiny", options=list(width="100%", height=600)) -->
<!-- ``` -->
